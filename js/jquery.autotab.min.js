/**
 * Autotab - jQuery plugin 1.3
 * https://github.com/Mathachew/jquery-autotab
 * 
 * Copyright (c) 2013 Matthew Miller
 * 
 * Licensed under the MIT licensing:
 *   http://www.opensource.org/licenses/mit-license.php
 */

(function(e){var m=null,n=function(b,d){if(null!==d&&"undefined"!==typeof d)for(var a in d)"format"==a||"target"==a||"previous"==a?e(b).data("autotab-"+a,d[a]):b.setAttribute("data-autotab-"+a,d[a])},k=function(b){var d=navigator.platform,a={loaded:!1,disabled:!1,pattern:null,uppercase:!1,lowercase:!1,nospace:!1,maxlength:2147483647},f;for(f in a)a[f]=b.getAttribute("data-autotab-"+f)||a[f];a.format=e(b).data("autotab-format")||"all";a.target=e(b).data("autotab-target")||a.target;a.previous=e(b).data("autotab-previous")||
a.previous;a.iOS=b.getAttribute("data-autotab-iOS")||"iPad"===d||"iPhone"===d||"iPod"===d;a.firefox=b.getAttribute("data-autotab-Firefox")||"undefined"!==typeof InstallTrigger;a.loaded||n(b,a);return a};e.autotab={next:function(){var b=e(document.activeElement);b.length&&setTimeout(function(){b.trigger("autotab-next")},1)},previous:function(){var b=e(document.activeElement);b.length&&setTimeout(function(){b.trigger("autotab-previous")},1)}};e.fn.autotab=function(b,d){if(!this.length)return this;if("filter"==
b){if("string"===typeof d||"function"===typeof d)d={format:d};for(var a=0,f=this.length;a<f;a++){var h=k(this[a]),c=d;c.target=h.target;c.previous=h.previous;e.extend(h,c);n(this[a],h)}}else if("remove"==b||"destroy"==b||"disable"==b)for(a=0,f=this.length;a<f;a++)h=k(this[a]),h.disabled=!0,n(this[a],h);else if(null===b||"undefined"===typeof b?d={}:"string"===typeof b||"function"===typeof b?d={format:b}:"object"===typeof b&&(d=b),1<this.length)for(a=0,f=this.length;a<f;a++){var h=a+1,q=a-1,c=d;0<a&&
h<f?(c.target=this[h],c.previous=this[q]):0<a?(c.target=null,c.previous=this[q]):(c.target=this[h],c.previous=null);r(this[a],c)}else r(this[0],d);return this};var p=function(b,d,a){if("function"===typeof a.format)return a.format(d,b);b=null;switch(a.format){case "text":b=RegExp("[0-9]+","g");break;case "alpha":b=RegExp("[^a-zA-Z]+","g");break;case "number":case "numeric":b=RegExp("[^0-9]+","g");break;case "alphanumeric":b=RegExp("[^0-9a-zA-Z]+","g");break;case "hex":case "hexadecimal":b=RegExp("[^0-9A-Fa-f]+",
"g");break;case "custom":b=RegExp(a.pattern,"g")}null!==b&&(d=d.replace(b,""));a.nospace&&(b=RegExp("[ ]+","g"),d=d.replace(b,""));a.uppercase&&(d=d.toUpperCase());a.lowercase&&(d=d.toLowerCase());return d},r=function(b,d){var a=k(b);if("true"==a.disabled||!0===a.disabled)a.disabled=!1,a.target=null,a.previous=null;e.extend(a,d);"string"!==typeof a.target&&a.target instanceof jQuery||(a.target=e(a.target));"string"!==typeof a.previous&&a.previous instanceof jQuery||(a.previous=e(a.previous));var f=
b.maxLength;2147483647==a.maxlength&&2147483647!=f?a.maxlength=f:0<a.maxlength?b.maxLength=a.maxlength:a.target=null;a.loaded?n(b,a):(a.loaded=!0,n(b,a),e(b).on("autotab-next",function(a,c){c||(c=k(this));"true"!=c.disabled&&!0!==c.disabled&&c.target.length&&"true"!=c.iOS&&!0!==c.iOS&&(c.target.focus().select(),m=new Date)}).on("autotab-previous",function(a,c){c||(c=k(this));if("true"!=c.disabled&&!0!==c.disabled&&c.previous.length){c.previous.focus();if(c.firefox){var b=c.previous.val().length;c.previous[0].setSelectionRange(b,
b)}else c.previous.val(c.previous.val());m=null}}).on("keydown",function(a){var c=k(this);if(!c||"true"==c.disabled)return!0;var b=a.which||a.charCode;if(8==b&&0===this.value.length&&c.previous.length)e(this).trigger("autotab-previous",c);else if(9==b&&null!==m)if(a.shiftKey)m=null;else{if(800>(new Date).getTime()-m.getTime())return m=null,!1}else m=null}).on("keypress",function(a){var c=k(this);if(!c||"true"==c.disabled||!0===c.disabled)return!0;var b=a.which||a.keyCode,d=p(this,String.fromCharCode(b),
c),l=document.selection&&document.selection.createRange?!0:0<a.charCode;if(a.ctrlKey||a.altKey)return!0;if(l&&(null===d||""===d))return a.ctrlKey;if(l&&this.value.length<=this.maxLength){var g;if("number"===typeof this.selectionStart&&"number"===typeof this.selectionEnd){g=this.selectionStart;a=this.selectionEnd;if(0===g&&a==this.value.length)this.value=d;else{if(this.value.length==this.maxLength)return e(this).trigger("autotab-next",c),!1;this.value=this.value.slice(0,g)+d+this.value.slice(a)}this.selectionStart=
this.selectionEnd=g+1}else if(document.selection&&document.selection.createRange){a=document.selection.createRange();l=this.createTextRange();g=this.createTextRange();var f=a.getBookmark();l.moveToBookmark(f);g.setEndPoint("EndToStart",l);g=g.text.length;a=g+a.text.length;if(0===g&&a==this.value.length)this.value=d;else{if(this.value.length==this.maxLength)return e(this).trigger("autotab-next",c),!1;this.value=this.value.slice(0,g)+d+this.value.slice(a)}g++;l=this.createTextRange();l.collapse(!0);
l.move("character",g-(this.value.slice(0,g).split("\r\n").length-1));l.select()}}if("true"==c.firefox||!0===c.firefox)return-1=="8,9,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,144,145".indexOf(b)&&"undefined"!==typeof b?(this.value.length==c.maxlength&&e(this).trigger("autotab-next",c),!1):!0;this.value.length==c.maxlength&&e(this).trigger("autotab-next",c);return!1}).on("paste",function(a){var b=k(this);if(!b)return!0;var d=function(a,f,g){if(a){k(a);var h=a.maxLength;if(!b||"true"==b.disabled||
!0===b.disabled)return!0;n(a,b);a.maxLength=2147483647;setTimeout(function(){null===f&&(f=a.value);var k;k=null!==g?p(a,f.substr(f.indexOf(g)+g.length),b).substr(0,h):p(a,f,b).substr(0,h);a.maxLength=h;k?(a.value=k,k.length==h&&(e(a).trigger("autotab-next",b),"true"!=b.iOS&&!0!==b.iOS&&d(b.target[0],f,k))):a.value=""},1)}};d(this,null,null)}))};e.fn.autotab_magic=function(b){e(this).autotab()};e.fn.autotab_filter=function(b){var d={};"string"===typeof b||"function"===typeof b?d.format=b:e.extend(d,
b);e(this).autotab("filter",d)}})(jQuery);
